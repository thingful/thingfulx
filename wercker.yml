box: golang

# Build definition
build:
    # The steps that will be executed on build
    steps:
        - setup-go-workspace

        - script:
            name: go info
            code: |
              go version

        - script:
            name: install glide
            code: |
              curl --location -o /tmp/glide-v0.11.1-linux-amd64.tar.gz https://github.com/Masterminds/glide/releases/download/v0.11.1/glide-v0.11.1-linux-amd64.tar.gz
              tar zxf /tmp/glide-v0.11.1-linux-amd64.tar.gz
              mv /tmp/linux-amd64/glide /usr/bin/glide

        - script:
            name: install deps
              glide install

        - script:
            name: setup
            code: |
              make setup

        - script:
            name: appease linter
            code: |
              go build -i

        - script:
            name: test
            code: |
              make test coverage html ARTEFACT_DIR=$WERCKER_REPORT_ARTIFACTS_DIR

        - script:
            name: lint
            code: |
              make lint

